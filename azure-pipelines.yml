trigger:
  - main
pool:
  name: local

variables:
  buildConfiguration: 'Release'

stages:
  - stage: InstallAndBuild
    displayName: Build Frontend and Backend
    jobs:
      - job: BuildFrontend
        displayName: 'Build Frontend'
        pool:
          name: local
        steps:
          - checkout: self 

          - task: NodeTool@0
            inputs:
              versionSpec: '20.x'
            displayName: 'Use Node.js'

          - script: |
              cd frontend
              npm install
              npm run build
            displayName: 'Install & Build Frontend'

          - task: PublishBuildArtifacts@1
            inputs:
              pathToPublish: 'frontend/dist'
              artifactName: 'frontend-build'
              publishLocation: 'Container'

      - job: BuildBackend
        displayName: 'Build Backend'
        pool:
          name: local
        steps:
          - checkout: self  

          - task: NodeTool@0
            inputs:
              versionSpec: '20.x'
            displayName: 'Use Node.js'

          - script: |
              cd backend
              npm install
            displayName: 'Install Backend'

          - task: PublishBuildArtifacts@1
            inputs:
              pathToPublish: 'backend'
              artifactName: 'backend-src'
              publishLocation: 'Container'  

  - stage: SonarMock
    displayName: 'Mock SonarQube Stage'
    jobs:
      - job: SonarFake
        displayName: 'Mock Sonar'
        pool:
          name: local
        steps:
          - script: echo "Pretending to run SonarQube..."
            displayName: 'Mock SonarQube Analysis'

  - stage: TestMock
    displayName: 'Mock Test Stage'
    jobs:
      - job: RunFakeTests
        displayName: 'Mock Tests'
        pool:
          name: local
        steps:
          - script: echo "Running dummy tests..."
            displayName: 'Mock Unit Test + Coverage'
